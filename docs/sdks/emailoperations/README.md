# EmailOperations

## Overview

### Available Operations

* [send](#send) - Send a transactional email

## send

Send a transactional email using the configured SMTP server with a pre-defined template.<br><br>

<b>Overview:</b><br>
This is an internal service endpoint used by other PipesHub services to send transactional emails.
It uses Handlebars templates to generate HTML emails with dynamic content. All sent emails are
logged to the database for audit purposes.<br><br>

<b>Authentication:</b><br>
Requires a scoped token with <code>mail:send</code> scope. This endpoint is not accessible
with regular user JWT tokens - it is designed for service-to-service communication only.<br><br>

<b>Available Templates:</b><br>
<ul>
<li><b>loginWithOTP</b> - Send OTP code for user authentication. Requires: <code>name</code>, <code>otp</code></li>
<li><b>resetPassword</b> - Password reset link. Requires: <code>name</code>, <code>link</code></li>
<li><b>accountCreation</b> - Welcome email for new organizations. Requires: <code>orgName</code>, <code>link</code></li>
<li><b>appuserInvite</b> - Invitation to join organization. Requires: <code>invitee</code>, <code>orgName</code>, <code>link</code></li>
<li><b>suspiciousLoginAttempt</b> - Security alert. Requires: <code>link</code></li>
</ul>

<b>Email Delivery Flow:</b><br>
<ol>
<li>Validate SMTP configuration exists (middleware check)</li>
<li>Validate scoped token has <code>mail:send</code> scope</li>
<li>Select and compile Handlebars template with provided data</li>
<li>Send email via nodemailer using SMTP configuration</li>
<li>Log email metadata to MongoDB (subject, from, to, cc, templateType)</li>
</ol>

<b>Important Notes:</b><br>
<ul>
<li>The "From" address is always taken from SMTP config, not the request body</li>
<li>Failed email sends return 500 with error details</li>
<li>Template mismatches throw "Unknown Template" error</li>
<li>SMTP must be configured before using this endpoint</li>
</ul>

<b>Related Endpoints:</b><br>
<ul>
<li><code>POST /configurationManager/smtpConfig</code> - Configure SMTP server</li>
<li><code>POST /mail/updateSmtpConfig</code> - Reload SMTP configuration at runtime</li>
</ul>


### Example Usage: accountCreation

<!-- UsageSnippet language="python" operationID="sendEmail" method="post" path="/mail/emails/sendEmail" example="accountCreation" -->
```python
import os
from pipeshub import Pipeshub, models


with Pipeshub(
    server_url="https://api.example.com",
) as p_client:

    res = p_client.email_operations.send(security=models.SendEmailSecurity(
        scoped_token=os.getenv("PIPESHUB_SCOPED_TOKEN", ""),
    ), email_template_type="accountCreation", send_email_to=[
        "admin@neworg.com",
    ], product_name="PipesHub", is_auto_email=False, from_email_domain="noreply@company.com", subject="Welcome to PipesHub!", template_data={
        "org_name": "New Organization Inc",
        "link": "https://app.pipeshub.com/login",
    }, send_cc_to=[
        "manager@example.com",
    ], attachments=[
        {
            "filename": "report.pdf",
            "content_type": "application/pdf",
        },
    ])

    # Handle response
    print(res)

```
### Example Usage: loginOTP

<!-- UsageSnippet language="python" operationID="sendEmail" method="post" path="/mail/emails/sendEmail" example="loginOTP" -->
```python
import os
from pipeshub import Pipeshub, models


with Pipeshub(
    server_url="https://api.example.com",
) as p_client:

    res = p_client.email_operations.send(security=models.SendEmailSecurity(
        scoped_token=os.getenv("PIPESHUB_SCOPED_TOKEN", ""),
    ), email_template_type="loginWithOTP", send_email_to=[
        "user@example.com",
    ], product_name="PipesHub", is_auto_email=True, from_email_domain="noreply@company.com", subject="Your OTP Code for PipesHub", template_data={
        "name": "John Doe",
        "otp": "123456",
    }, send_cc_to=[
        "manager@example.com",
    ], attachments=[
        {
            "filename": "report.pdf",
            "content_type": "application/pdf",
        },
    ])

    # Handle response
    print(res)

```
### Example Usage: passwordReset

<!-- UsageSnippet language="python" operationID="sendEmail" method="post" path="/mail/emails/sendEmail" example="passwordReset" -->
```python
import os
from pipeshub import Pipeshub, models


with Pipeshub(
    server_url="https://api.example.com",
) as p_client:

    res = p_client.email_operations.send(security=models.SendEmailSecurity(
        scoped_token=os.getenv("PIPESHUB_SCOPED_TOKEN", ""),
    ), email_template_type="resetPassword", send_email_to=[
        "user@example.com",
    ], product_name="PipesHub", is_auto_email=False, from_email_domain="noreply@company.com", subject="Reset Your PipesHub Password", template_data={
        "name": "John Doe",
        "link": "https://app.pipeshub.com/reset-password?token=abc123xyz",
    }, send_cc_to=[
        "manager@example.com",
    ], attachments=[
        {
            "filename": "report.pdf",
            "content_type": "application/pdf",
        },
    ])

    # Handle response
    print(res)

```
### Example Usage: securityAlert

<!-- UsageSnippet language="python" operationID="sendEmail" method="post" path="/mail/emails/sendEmail" example="securityAlert" -->
```python
import os
from pipeshub import Pipeshub, models


with Pipeshub(
    server_url="https://api.example.com",
) as p_client:

    res = p_client.email_operations.send(security=models.SendEmailSecurity(
        scoped_token=os.getenv("PIPESHUB_SCOPED_TOKEN", ""),
    ), email_template_type="suspiciousLoginAttempt", send_email_to=[
        "user@example.com",
    ], product_name="PipesHub", is_auto_email=False, from_email_domain="noreply@company.com", subject="Security Alert: Suspicious Login Attempt", template_data={
        "link": "https://app.pipeshub.com/support",
    }, send_cc_to=[
        "manager@example.com",
    ], attachments=[
        {
            "filename": "report.pdf",
            "content_type": "application/pdf",
        },
    ])

    # Handle response
    print(res)

```
### Example Usage: userInvitation

<!-- UsageSnippet language="python" operationID="sendEmail" method="post" path="/mail/emails/sendEmail" example="userInvitation" -->
```python
import os
from pipeshub import Pipeshub, models


with Pipeshub(
    server_url="https://api.example.com",
) as p_client:

    res = p_client.email_operations.send(security=models.SendEmailSecurity(
        scoped_token=os.getenv("PIPESHUB_SCOPED_TOKEN", ""),
    ), email_template_type="appuserInvite", send_email_to=[
        "newuser@example.com",
    ], product_name="PipesHub", is_auto_email=False, from_email_domain="noreply@company.com", subject="You've been invited to join Acme Corp on PipesHub", template_data={
        "invitee": "Admin User",
        "org_name": "Acme Corp",
        "link": "https://app.pipeshub.com/invite?token=invite123",
    }, send_cc_to=[
        "manager@example.com",
    ], attachments=[
        {
            "filename": "report.pdf",
            "content_type": "application/pdf",
        },
    ])

    # Handle response
    print(res)

```

### Parameters

| Parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Required                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `security`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | [models.SendEmailSecurity](../../models/sendemailsecurity.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | :heavy_check_mark:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | N/A                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `email_template_type`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | [models.EmailTemplateType](../../models/emailtemplatetype.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | :heavy_check_mark:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Type of email template to use. Each template has specific `templateData` requirements:<br/>- `loginWithOTP`: OTP authentication email<br/>- `resetPassword`: Password reset link email<br/>- `accountCreation`: Welcome email for new organizations<br/>- `appuserInvite`: Invitation email to join an organization<br/>- `suspiciousLoginAttempt`: Security alert for multiple failed OTP attempts<br/>                                                                                                                                                                                                                                                                                                                                                                                                                 | loginWithOTP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `send_email_to`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | List[*str*]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | :heavy_check_mark:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | List of recipient email addresses (at least one required)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | [<br/>"user@example.com"<br/>]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `product_name`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | *Optional[str]*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | :heavy_minus_sign:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Name of the product sending the email (used in templates for branding)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | PipesHub                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `is_auto_email`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | *Optional[bool]*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | :heavy_minus_sign:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Flag indicating if this is an automated system email (for tracking/filtering purposes)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `from_email_domain`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | *Optional[str]*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | :heavy_minus_sign:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Sender email address for audit logging. **Note:** The actual "From" address used<br/>in the email is taken from the SMTP server configuration (`smtpConfig.fromEmail`),<br/>not this field. This field is stored in the database for record-keeping.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | noreply@company.com                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `subject`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | *Optional[str]*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | :heavy_minus_sign:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Email subject line                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Your OTP Code for PipesHub                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `template_data`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | [Optional[models.TemplateData]](../../models/templatedata.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | :heavy_minus_sign:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Dynamic data to populate the email template. Required fields depend on <code>emailTemplateType</code>.<br><br><br/><b>Template Data Requirements:</b><br><br/><ul><br/><li><b>loginWithOTP:</b> See <code>LoginWithOTPTemplateData</code> - requires <code>name</code>, <code>otp</code></li><br/><li><b>resetPassword:</b> See <code>ResetPasswordTemplateData</code> - requires <code>name</code>, <code>link</code></li><br/><li><b>accountCreation:</b> See <code>AccountCreationTemplateData</code> - requires <code>orgName</code>, <code>link</code></li><br/><li><b>appuserInvite:</b> See <code>AppUserInviteTemplateData</code> - requires <code>invitee</code>, <code>orgName</code>, <code>link</code></li><br/><li><b>suspiciousLoginAttempt:</b> See <code>SuspiciousLoginTemplateData</code> - requires <code>link</code></li><br/></ul><br/> |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `send_cc_to`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | List[*str*]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | :heavy_minus_sign:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Optional list of CC recipient email addresses                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | [<br/>"manager@example.com"<br/>]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `attachments`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | List[[models.Attachment](../../models/attachment.md)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | :heavy_minus_sign:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Optional email attachments (uses nodemailer attachment format)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `retries`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | [Optional[utils.RetryConfig]](../../models/utils/retryconfig.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | :heavy_minus_sign:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Configuration to override the default retry behavior of the client.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

### Response

**[models.SendEmailResponse](../../models/sendemailresponse.md)**

### Errors

| Error Type                          | Status Code                         | Content Type                        |
| ----------------------------------- | ----------------------------------- | ----------------------------------- |
| errors.BadRequestError              | 400                                 | application/json                    |
| errors.NotFoundError                | 404                                 | application/json                    |
| errors.SendEmailInternalServerError | 500                                 | application/json                    |
| errors.PipeshubDefaultError         | 4XX, 5XX                            | \*/\*                               |